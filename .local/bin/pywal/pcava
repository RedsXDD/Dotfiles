#!/usr/bin/env sh

# Script dependencies: gnutls, python-pywal, cava
# shellcheck disable=1091,2154

cava_config="${XDG_CONFIG_HOME:-$HOME/.config}/cava/config"

if [ -z "$DISPLAY" ]; then
	gen_theme_config(){
		cat <<- CONF_NO_DISPLAY
		[color]

		background = 'default'
		foreground = 'cyan'
		; gradient = 0
		; gradient_count = 8
		; gradient_color_1 = '#59cc33'
		; gradient_color_2 = '#80cc33'
		; gradient_color_3 = '#a6cc33'
		; gradient_color_4 = '#cccc33'
		; gradient_color_5 = '#cca633'
		; gradient_color_6 = '#cc8033'
		; gradient_color_7 = '#cc5933'
		; gradient_color_8 = '#cc3333'
		CONF_NO_DISPLAY
	}
else
	[ -f "${XDG_CACHE_HOME:-$HOME/.cache}/wal/colors.sh" ] && . "${XDG_CACHE_HOME:-$HOME/.cache}/wal/colors.sh"

	gen_theme_config(){
		cat <<- CONF_DISPLAY
		[color]

		background = '$background'
		foreground = '$foreground'
		gradient = 1
		gradient_count = 4
		gradient_color_1 = '$color6'
		gradient_color_2 = '$color4'
		gradient_color_3 = '$color5'
		gradient_color_4 = '$color1'
		; gradient_color_5 = '$color0'
		; gradient_color_6 = '$color0'
		; gradient_color_7 = '$color0'
		; gradient_color_8 = '$color0'
		CONF_DISPLAY
	}
fi

cava_tmp="$(mktemp)"
trap 'rm -rf "$cava_tmp"' 0 1 15

[ -f "$cava_config" ] && cat "$cava_config" > "$cava_tmp"
gen_theme_config >> "$cava_tmp"
cava -p "$cava_tmp"

# vim:fileencoding=utf-8:foldmethod=marker
