#!/usr/bin/env sh

# Script dependencies: gnutls, zellij, pywal (optional)

zellij_config_dir="${XDG_CONFIG_HOME:-$HOME/.config}/zellij"
zellij_config="$zellij_config_dir/config.kdl"

# Setup temporary file to store the new customized zellij config:
tmp_zellij_config="$(mktemp)"
trap 'rm -rf "$tmp_zellij_config" >/dev/null 2>&1' 0 1 15

if [ -n "$DISPLAY" ]; then
	[ -f "$zellij_config_dir/layouts/zjstatus_wallust.kdl" ] && cp -f "$zellij_config_dir/layouts/zjstatus_wallust.kdl" "$zellij_config_dir/layouts/default.kdl"
	cat "$zellij_config" > "$tmp_zellij_config"
else
	# Generate a TTY compatible config for zellij:
	[ -f "$zellij_config_dir/layouts/zjstatus_tty.kdl" ] && cp -f "$zellij_config_dir/layouts/zjstatus_tty.kdl" "$zellij_config_dir/layouts/default.kdl"

	sed 's/.*simplified_ui.*false/simplified_ui true/g;
		s/.*rounded_corners.*true/rounded_corners false/g;
		s/^\s*theme //g;
		s/^\s*theme_dir//g' "$zellij_config" > "$tmp_zellij_config"
fi

zellij --config="$tmp_zellij_config" "$@"

# vim:fileencoding=utf-8:foldmethod=marker
