#!/usr/bin/env sh

gen_script(){
	cat <<- EOF
	#!/usr/bin/env sh

	# Script dependencies: gnutls

	# vim:fileencoding=utf-8:foldmethod=marker
	EOF
}

script_dir="${2:-$HOME/.local/bin}"
if [ ! -d "$script_dir" ]; then
	mkdir -p "$script_dir" || exit 1
fi

script_name="$1"
while [ -z "$script_name" ]; do printf 'Give the name of the script you want to create/edit: '; read -r script_name; done
if [ -f "${script_dir}/${script_name}" ]; then
	nvim "${script_dir}/${script_name}"
else
	printf 'Are you sure you want to create a the new script "%s" at "%s"? (y/n): ' "$script_name" "$script_dir"; read -r confirm
	case "$(echo "$confirm" | tr '[:upper:]' '[:lower:]')" in
		'y' | 'yes')
			gen_script > "${script_dir}/${script_name}"
			chmod 755 "${script_dir}/${script_name}"
			nvim "${script_dir}/${script_name}"
		;;
		*) exit 1 ;;
	esac
fi
