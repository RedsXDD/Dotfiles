#!/usr/bin/env sh

# Use Generated Menu from DM-Core:
# shellcheck disable=SC1091
menu(){ . "$HOME"/.cache/dm-core/menu; }
walls_dir="$HOME/Pictures/wallpapers/all"
base_dir="$HOME/.config/wal/colorschemes/main-schemes"

# Main Function:
themer()
{
 theme="$*"
 templates_dir="$HOME/.config/wal/templates"
 templates_dark="$HOME/.config/wal/colorschemes-templates/dark"
 wals_dir_dark="$HOME/Pictures/wallpapers/color-schemes/dark"
 wals_dir_light="$HOME/Pictures/wallpapers/color-schemes/light"

 cat_wal_dark="$wals_dir_dark/catppuccin/os/artix-black-4k.png"
 doomone_wal_dark="$wals_dir_dark/doom-one/0229.png"
 dra_wal_dark="$wals_dir_dark/dracula/os/arch.png"
 gruv_wal_dark="$wals_dir_dark/gruvbox/gruv-nvim.png"
 nord_wal_dark="$wals_dir_dark/nord/70.png"
 oce_wal_dark="$wals_dir_dark/oceanic-next/48.png"
 sola_wal_dark="$wals_dir_dark/solarized/wp4657379-solarized-wallpapers.png"

 case "$theme" in
  *'light'*) theme="$(echo "$theme" | sed "s|^|$base_dir/light/|g")" ;;
  *'dark'*) theme="$(echo "$theme" | sed "s|^|$base_dir/dark/|g")"; cp -f "$templates_dark"/base/* "$templates_dir"
   case "$theme" in
    *'catppuccin'*)     wall="$cat_wal_dark"    ; cp -f "$templates_dark"/catppuccin/* "$templates_dir"     ;;
    *'doomone'*)        wall="$doomone_wal_dark"; cp -f "$templates_dark"/doom-one/* "$templates_dir"       ;;
    *'dracula'*)        wall="$dra_wal_dark"    ; cp -f "$templates_dark"/dracula/* "$templates_dir"        ;;
    *'gruvbox'*)        wall="$gruv_wal_dark"   ; cp -f "$templates_dark"/gruvbox/* "$templates_dir"        ;;
    *'monokaipro'*)                               cp -f "$templates_dark"/monokaipro/* "$templates_dir"     ;;
    *'monokai'*)                                  cp -f "$templates_dark"/monokai/* "$templates_dir"        ;;
    *'nord'*)           wall="$nord_wal_dark"   ; cp -f "$templates_dark"/nord/* "$templates_dir"           ;;
    *'oceanic-next'*)   wall="$oce_wal_dark"    ; cp -f "$templates_dark"/oceanic-next/* "$templates_dir"   ;;
    *'palenight'*)                                cp -f "$templates_dark"/palenight/* "$templates_dir"      ;;
    *'solarized'*)      wall="$sola_wal_dark"   ; cp -f "$templates_dark"/solarized/* "$templates_dir"      ;;
    *'tommorow-night'*)                           cp -f "$templates_dark"/tommorow-night/* "$templates_dir" ;;
    *'zenburn'*)                                  cp -f "$templates_dark"/zenburn/* "$templates_dir"        ;;
   esac
  ;;
 esac

 # Set ColorScheme & Wallpaper:
 wal --theme "$theme"
 [ -f "$wall" ] && [ -n "$wall" ] && feh --bg-scale "$wall" ||
 wall="$(
 ls -1A "$walls_dir" |\
 shuf -n1 |\
 sed "s|^|$walls_dir/|")" && feh --bg-scale "$wall"

 # Reload DWM/ST:
 dwmpid="$(pgrep dwm)"; [ -n "$dwmpid" ] && kill -HUP "$dwmpid"
 killall -USR1 st >/dev/null 2>&1
}

# Define Lists:
light_list="$(ls -1A "$base_dir/light")"
dark_list="$(ls -1A "$base_dir/dark")"
# shellcheck disable=SC2183
extra_list="$(printf 'Random_Dark''%s\n''Random_Light''%s\n''Truly_Random')"

# Select Color Scheme:
choice="$(printf "$light_list"'%s\n'"$dark_list"'%s\n'"$extra_list" | sed 's/\.json.*$//' | sort | menu -p 'Choose Color Scheme')"

# Apply Color Scheme:
choice="$(echo "$choice" | tr '[:upper:]' '[:lower:]')"
case "$choice" in
 '') echo 'ERROR: No Theme Selected.'; exit 1 ;;
 'random_dark') result="$(ls -1A "$base_dir/dark" | shuf -n1)"; themer "$result" ;;
 'random_light') result="$(ls -1A "$base_dir/light" | shuf -n1)"; themer "$result" ;;
 'truly_random')
   select="$(seq 1 2 | shuf -n1)"
   case "$select" in
    '1')
     result="$(printf '%s\n' "$dark_list" | shuf -n1)"
     themer "$result"
    ;;
    '2')
     result="$(printf '%s\n' "$light_list" | shuf -n1)"
     themer "$result"
    ;;
    *) echo 'Program Terminated.' && exit 1
   esac
 ;;
 *) themer "$choice" ;;
esac

# Sucessfull Theme Change Notification:
theme="$(echo "$theme" | awk -F '/' '{print $NF}' | sed s/\.json//g)"
killall dunst
dunst &
notify-send -t 2000 "Sucessfully Changed Theme to:" "$theme"
