#!/usr/bin/env sh

# Setup functions & variables:
base_file="$HOME/.config/rofi_base/edit-configs"
# shellcheck disable=SC1091
menu(){ rofi -i -dmenu "$@"; }
# shellcheck disable=SC1091
editor(){ "$TERMINAL" -e "$EDITOR" "$@"; }
alaedit(){ alacritty -e "$EDITOR" "$@"; }

errcode(){
 case "$@" in
  1) echo "$(tput bold)$(tput setaf 1)ERROR: $(tput sgr0)$(tput bold)no file was choosen" ;;
  2) echo "$(tput bold)$(tput setaf 1)ERROR: $(tput sgr0)$(tput bold)the file $file does not exist" ;;
 esac
 exit 1
}

# Choose file:
choosen="$(\
 sed '/^#/d; s/#.*//g; /^$/d' < "$base_file" |
 awk -F '§§' '{print $1}' |
 sed 's/\s*$//g' |
 sort -u |
 menu -p "File To Edit")"

# Check if smth was selected & define/correct file variable based on choice:
[ -z "$choosen" ] && errcode 1
file="$(\
 sed '/^#/d; s/#.*//g; /^$/d' < "$base_file" |
 grep "$choosen\s*§§" |
 awk -F '§§' '{print $2}' |
 sed "s/^\s*//g; s|~|$HOME|")"

# Check if file exists and edit it if it does:
# shellcheck disable=SC2086
[ ! -f $file ] && errcode 2 ||
 # If file is the alacritty config open it in alacritty, otherwise proceed as normal:
 # shellcheck disable=SC2086
 [ $file = "$HOME/.config/alacritty/alacritty.yml" ] &&
  alaedit $file ||
  editor $file
