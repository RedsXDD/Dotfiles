#!/usr/bin/env sh

# Exit if necessary scripts aren't in PATH:
if ! which waybg || ! which wallust || ! which wallust_postrun; then
	exit 1
fi >/dev/null 2>&1

file="$(dirname "$@")/$(basename "$@")"
file_name="$(basename "$@")"
colorschemes_dir="${XDG_CONFIG_HOME:-$HOME/.config}/wallust/colorschemes"

apply_colorscheme(){ wallust cs "$1" && wallust_postrun; }

apply_wallpaper(){
	waybg "$1" &&
		notify-send -t 2000 'Wallust theming' 'Generating wallust theme.' &&
		wallust run -p dark16 "$(head -n1 "$HOME/.cache/waybg/wallpaper")" &&
		wallust_postrun
}

if [ -f "${colorschemes_dir}/light/${file_name}" ] || [ -f "${colorschemes_dir}/dark/${file_name}" ]; then
	apply_colorscheme "$file"
else
	apply_wallpaper "$file"
fi
