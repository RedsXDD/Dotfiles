#!/usr/bin/env sh

# Exit if necessary scripts aren't in PATH:
if ! which waybg || ! which wallust || ! which wallust_postrun; then
	exit 1
fi >/dev/null 2>&1

file="$(dirname "$@")/$(basename "$@")"
file_extension="$(basename -- "$file" | awk 'BEGIN { FS = "." } { print "." tolower($NF) }')"

apply_colorscheme(){ wallust cs "$1" && wallust_postrun; }

apply_wallpaper(){
	waybg "$1" &&
		notify-send -t 2000 'Wallust theming' 'Generating wallust theme.' &&
		wallust run -p dark16 "$(head -n1 "$HOME/.cache/waybg/wallpaper")" &&
		wallust_postrun
}

case "$file_extension" in
	'.json') apply_colorscheme "$file" ;;
	*)       apply_wallpaper "$file"   ;;
esac
